% This document is intended to be compiled in XeLaTeX
\documentclass[a4paper,12pt]{article}
\usepackage[margin=0.5in]{geometry}
\usepackage[utf8]{inputenc}

\usepackage{fontspec}
\setmainfont{NotoSerif}
\setsansfont{Open Sans}
\setmonofont{DejaVu Sans Mono}
\newfontfamily{\cyrillicfonttt}{DejaVu Sans Mono}

%\usepackage[russian]{babel} % uncomment for latex
% babel replacement for xelatex
\usepackage{polyglossia}
\setdefaultlanguage{russian}
\PolyglossiaSetup{russian}{indentfirst=true}

% \usepackage{blindtext}    % Generate dummy text
\usepackage{listings}	    % Code Listings (supports UTF-8)
\usepackage{tabularx}	    % Enhanced tabular
\usepackage{hyperref}	    % Hyperlinks inside document
\usepackage{array}	    % \tabular for text and \array for math
\usepackage{float}	    % Improve floating objects
\usepackage{verbatim}	    % \begin{verbatim} write \\anything you $$(_ want 
			    % \end{verbatim}

% Math
\usepackage{amsmath}	    % Basic Math Facilities
\usepackage{mathtools}	    % Enhance amsmath
\usepackage{amsfonts}	    % Extended set of fonts for math

% Graphics
\usepackage{graphicx}	    % \includegraphics and other
\usepackage{color}	    % Colors
\usepackage{xcolor}	    % Extended colors

\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\definecolor{keyword}{HTML}{000080}
\definecolor{number}{HTML}{0406FF}
\definecolor{string}{HTML}{228000}
\definecolor{comment}{HTML}{808080}

\lstset{
        language=C,
        basicstyle=\ttfamily\scriptsize,
        frame=single,
        keywordstyle=\color{keyword},
        numberstyle=\tiny\color{number}
        stringstyle=\color{string},
        commentstyle=\color{comment},
        tabsize=2,
        title=\lstname,
        breaklines=true,
        breakautoindent=true
}

\renewcommand{\refname}{Список литературы}
\pagestyle{empty}
\graphicspath{ {../figure/} }


\begin{document}
\begin{titlepage}
\begin{center}
    Университет ИТМО, кафедра ВТ
    
    \vspace{\stretch{3}}
    \large
    Лабораторная работа №2          \\
    по дисциплине \\
    «Информационно-Управляющие Системы» \\

    «Таймеры. Система прерываний»
   
    \normalsize
    Вариант 7

\end{center}

\vspace{\stretch{5}}
\begin{flushright}{
        \large 
        Работу выполнили                 \\
        студенты группы P3400    \\
        \textbf{
            Магдиева З.Х. \\
            Рогов Я.С.    \\
            Сергеев В.В.}       
        
        \vspace{\stretch{1}}
        Преподаватель:          \\
        \textbf{Ключев А.О.}
}\end{flushright}

\vspace{\stretch{7}}
\begin{center}{
        Санкт-Петербург, \the\year
    }
\end{center}
\end{titlepage}

\section{Цели работы}
Разработать и реализовать драйвер системного таймера микроконтроллера ADuC812.
Написать тестовую программу с использованием разработанного драйвера по алгоритму,
соответствующему варианту задания.


\section{Исходные данные}
Данная лабораторная работа посвящена изучению таймера и системы прерываний
микроконтроллера ADuC812. Основными функциями системного таймера являются:
измерение интервалов времени и выполнение периодических задач. В данной работе с
помощью таймеров требуется управлять светодиодными индикаторами (динамическая
индикация) или звуковым излучателем (проигрывание мелодии), входящими в состав
контроллера SDK-1.1.
    
Драйвер системного таймера должен состоять из двух частей: основной части,
находящейся в обработчике прерывания и прикладной части – API-функций, используемых в
программе:

\bigskip
\begin{tabularx}{\textwidth}{|X|X|}
    \hline
    void InitTimer(void)                    & Инициализация таймера. \\\hline
    unsigned long GetMsCounter(void)        & Получение текущей метки времени в миллисекундах. \\\hline
    unsigned long DTimeMs(unsigned long t0) & Измерение количества миллисекунд, прошедших с временной метки t0 и до текущего времени. \\\hline
    void DelayMs(unsigned long t)           & Задержка на t миллисекунд. \\\hline
\end{tabularx}
\bigskip

Кроме того, могут быть реализованы функции работы с таймером в режиме «счетчик»
(например, чтение счетчика).

Драйвер светодиодных индикаторов/звукового излучателя (зависит от варианта
задания) должен быть реализован по тому же принципу, что и драйвер системного таймера.
А именно: в обработчике прерывания от таймера должна выполняется сама динамическая
индикация/проигрывание мелодии – примеры периодических задач, а через API-функции
осуществляется настройка отображения анимации/звука и управление этими процессами.

\section{Реализация}

\lstinputlisting{../include/led.h}
\lstinputlisting{../src/led.c}
\lstinputlisting{../include/timer.h}
\lstinputlisting{../src/timer.c}
\lstinputlisting{../src/main.c}


\section{Выводы}
В ходе данной лабораторной работы были изучены принципы работы с таймером 
микроконтроллера ADuC812, а также был реализован драйвер для него.

\end{document}
